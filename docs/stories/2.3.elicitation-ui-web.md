# Story 2.3: Elicitation UI Rendering (Web)

**Status:** Ready for Review

---

## Story

**As a** web banking customer  
**I want to** see clear prompts for required confirmations  
**So that** I can complete payment authorization

---

## Acceptance Criteria

1. Client receives elicitation schema via LiveKit data channel
2. Client renders appropriate UI based on elicitation type (OTP, confirmation, form)
3. OTP input shows 6-digit code entry field
4. Confirmation dialog shows payment details with confirm/cancel buttons
5. Form renders multiple fields with validation
6. Payment details are displayed clearly (amount, payee, account - masked)
7. Client validates user input before submission
8. Client sends elicitation response via LiveKit data channel

---

## Tasks / Subtasks

- [x] Task 1: Data Channel Elicitation Handler (AC: 1)
  - [x] Created `useDataChannel.ts` hook to handle elicitation messages
  - [x] Parse elicitation schema from data channel
  - [x] Route to appropriate UI component
  - [x] Handle elicitation status updates

- [x] Task 2: OTP Input Component (AC: 3)
  - [x] Create `OTPInput` component
  - [x] 6-digit code entry with auto-focus
  - [x] Input validation (numbers only, 6 digits)
  - [x] Show error messages for invalid input
  - [x] Handle timeout countdown display

- [x] Task 3: Confirmation Dialog Component (AC: 4, 6)
  - [x] Create `ConfirmationDialog` component
  - [x] Display payment details (masked)
  - [x] Show amount, payee, account clearly
  - [x] Confirm and Cancel buttons
  - [x] Accessible keyboard navigation

- [x] Task 4: Form Component (AC: 5)
  - [x] Create `ElicitationForm` component
  - [x] Render fields based on schema
  - [x] Implement field validation
  - [x] Show validation errors
  - [x] Handle form submission

- [x] Task 5: Input Validation (AC: 7)
  - [x] Validate OTP format (6 digits)
  - [x] Validate form fields per schema
  - [x] Show client-side validation errors
  - [x] Prevent invalid submissions

- [x] Task 6: Response Submission (AC: 8)
  - [x] Format elicitation response payload
  - [x] Send via LiveKit data channel
  - [x] Handle submission errors
  - [x] Show loading state during submission

---

## Dev Notes

### Previous Story Insights
- Elicitation state management exists (Story 2.2)
- Data channel infrastructure needed

### Architecture References
[Source: docs/architecture.md#elicitation-architecture]

**Elicitation Schema:**
```typescript
interface ElicitationRequest {
  type: "elicitation";
  elicitation_id: string;
  elicitation_type: "otp" | "confirmation" | "form";
  schema: { fields: Array<ElicitationField> };
  context: { amount, payee, account };
}
```

**Platform Requirements:**
- Web: OTP-based authentication only
- No biometric requirement

### Existing Codebase Context

**Current Implementation:**
- No elicitation UI exists
- `useDataChannel.ts` hook doesn't exist yet
- Need to build elicitation components

**Files to Create:**
- `agent-starter-react/components/app/elicitation/OTPInput.tsx`
- `agent-starter-react/components/app/elicitation/ConfirmationDialog.tsx`
- `agent-starter-react/components/app/elicitation/ElicitationForm.tsx`
- `agent-starter-react/hooks/useDataChannel.ts`
- `agent-starter-react/hooks/useElicitation.ts`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | Scrum Master |
| 2025-11-20 | 1.1 | Implementation complete - all tasks done | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
None - No blocking issues encountered

### Completion Notes List
- Implemented complete elicitation UI system with LiveKit data channel integration
- Created reusable hooks: useDataChannel, useElicitation
- Built three main UI components: OTPInput, ConfirmationDialog, ElicitationForm
- Created ElicitationManager to orchestrate all elicitation types
- All components include proper validation, error handling, and loading states
- Fully accessible with keyboard navigation support
- Modal overlay with smooth animations

### File List

**Created Files:**
- `hooks/useDataChannel.ts` - LiveKit data channel handler
- `hooks/useElicitation.ts` - Elicitation state management hook
- `components/app/elicitation/OTPInput.tsx` - 6-digit OTP input component
- `components/app/elicitation/ConfirmationDialog.tsx` - Payment confirmation dialog
- `components/app/elicitation/ElicitationForm.tsx` - Dynamic form renderer
- `components/app/elicitation/ElicitationManager.tsx` - Main elicitation orchestrator

---

## QA Results
_To be filled by QA Agent_

