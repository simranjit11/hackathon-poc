# Story 3.3: Loans API Endpoint

**Status:** Ready for Development  
**Epic:** Epic 3 - Loans and Transactions Read Operations  
**Related Architecture:** [Mock Bank APIs Architecture](../../mock-bank/architecture.md)  
**Dependencies:** Story 3.0 (Database Schema)

---

## Story

**As a** banking customer  
**I want to** retrieve my loan information  
**So that** I can view my loan details including outstanding balance, interest rate, and payment schedule

---

## Acceptance Criteria

1. **API Endpoint**: `GET /api/banking/loans` endpoint implemented
   - Requires JWT authentication
   - Returns all loans for authenticated user

2. **Response Format**: Returns array of loan objects with:
   - `id`: Loan UUID
   - `loanType`: Loan type ("mortgage", "auto", "personal")
   - `loanNumber`: Loan number (unique identifier)
   - `outstandingBalance`: Current outstanding balance (Decimal)
   - `interestRate`: Interest rate (Decimal, e.g., 0.0375 for 3.75%)
   - `monthlyPayment`: Monthly payment amount (Decimal)
   - `remainingTermMonths`: Remaining term in months
   - `nextPaymentDate`: Next payment due date (ISO 8601)
   - `accountId`: Linked account ID (if applicable, null otherwise)
   - `createdAt`: Loan creation timestamp

3. **Security**: 
   - Only returns loans belonging to authenticated user
   - Uses existing authentication pattern

4. **Error Handling**: 
   - Returns 401 for authentication errors
   - Returns 500 for database errors

5. **Performance**: Response time < 200ms

---

## Tasks / Subtasks

- [ ] **Task 1: Create API Route**
  - [ ] Create `app/api/banking/loans/route.ts`
  - [ ] Implement GET handler with authentication
  - [ ] Implement OPTIONS handler for CORS

- [ ] **Task 2: Business Logic**
  - [ ] Query loans from database filtered by userId
  - [ ] Format response with required fields
  - [ ] Handle empty loan list (return empty array)

- [ ] **Task 3: Error Handling**
  - [ ] Handle authentication errors
  - [ ] Handle database errors

- [ ] **Task 4: Testing**
  - [ ] Test with valid authentication
  - [ ] Test with user having no loans
  - [ ] Test with user having multiple loans

---

## Dev Notes

### Architecture Alignment
- **Pattern**: Follows existing API route patterns
- **Location**: `app/api/banking/loans/route.ts`
- **Database**: Uses Prisma with Loan model

### Response Format
Interest rate should be returned as decimal (e.g., 0.0375) not percentage (3.75%) for consistency with database storage.

---

## Definition of Done

- [ ] API endpoint implemented
- [ ] Returns only user's loans
- [ ] Response format correct
- [ ] Error handling implemented
- [ ] Performance meets requirements

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | John (PM) |


