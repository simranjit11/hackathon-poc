# Story 2.4: Elicitation UI Rendering (Mobile with Biometric)

**Status:** Draft

---

## Story

**As a** mobile banking customer  
**I want to** authenticate with biometrics before providing OTP  
**So that** my payments are securely authorized

---

## Acceptance Criteria

1. Mobile client receives elicitation schema via LiveKit data channel
2. If biometric is required, client requests biometric authentication first
3. Biometric authentication uses native APIs (Face ID, Touch ID, Fingerprint)
4. After biometric success, client renders OTP/confirmation UI
5. Biometric token is included in elicitation response
6. Client handles biometric cancellation gracefully
7. Client handles biometric failure with retry option

---

## Tasks / Subtasks

- [ ] Task 1: Mobile Data Channel Integration (AC: 1)
  - [ ] Implement LiveKit data channel in React Native
  - [ ] Parse elicitation schema
  - [ ] Check platform requirements for biometric

- [ ] Task 2: Biometric Authentication Service (AC: 2, 3)
  - [ ] Install biometric library (react-native-biometrics or expo-local-authentication)
  - [ ] Create biometric authentication service
  - [ ] Detect available biometric type (Face ID, Touch ID, Fingerprint)
  - [ ] Request biometric authentication
  - [ ] Generate biometric token on success

- [ ] Task 3: Biometric-First Flow (AC: 4)
  - [ ] Check if biometric is required in elicitation schema
  - [ ] Show biometric prompt before OTP/confirmation
  - [ ] Only show OTP/confirmation after biometric success
  - [ ] Store biometric token for response

- [ ] Task 4: Elicitation UI Components (AC: 4)
  - [ ] Create mobile OTP input component
  - [ ] Create mobile confirmation dialog
  - [ ] Use native UI components where possible
  - [ ] Ensure consistent UX with web

- [ ] Task 5: Response with Biometric Token (AC: 5)
  - [ ] Include biometric token in elicitation response
  - [ ] Send response via data channel
  - [ ] Handle response errors

- [ ] Task 6: Error Handling (AC: 6, 7)
  - [ ] Handle biometric cancellation
  - [ ] Handle biometric failure
  - [ ] Show retry option
  - [ ] Notify user of errors

---

## Dev Notes

### Previous Story Insights
- Web elicitation UI exists (Story 2.3)
- Shared schema between web and mobile

### Architecture References
[Source: docs/architecture.md#elicitation-architecture]

**Platform-Specific Handling:**
- Mobile: Biometric authentication required before OTP/confirmation
- Native biometric prompts (Face ID, Touch ID, Fingerprint)
- Platform-specific UI rendering

**Biometric Flow:**
```
Elicitation Received
  ↓
Check if biometric required
  ↓
Request Biometric Auth
  ↓
Biometric Success → Generate Token
  ↓
Show OTP/Confirmation UI
  ↓
Submit with Biometric Token
```

### Existing Codebase Context

**Current Implementation:**
- `agent-starter-react-native` exists but no elicitation support
- Need to add biometric authentication
- Need to add data channel support

**Files to Create:**
- `agent-starter-react-native/services/biometricAuth.ts`
- `agent-starter-react-native/components/Elicitation/OTPInput.tsx`
- `agent-starter-react-native/components/Elicitation/ConfirmationDialog.tsx`
- `agent-starter-react-native/hooks/useDataChannel.ts`
- `agent-starter-react-native/hooks/useElicitation.ts`

### Dependencies

**React Native:**
- `react-native-biometrics` or `expo-local-authentication`
- `react-native-keychain` (for secure token storage)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | Scrum Master |

---

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

---

## QA Results
_To be filled by QA Agent_

